/**
 * angular-hy-res - Hypermedia client for AngularJS inspired by $resource
 * @version v0.0.10 - 2015-04-10
 * @link https://github.com/julienlafont/angular-hy-res
 * @author Julien LAFONT <julien.lafont@tabmo.fr>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-hy-res-hal",["angular-hy-res"]).provider("hrHalExtension",function(){this.$get=["hrWebLinkFactory","hrLinkCollection",function(e,r){var n=function(){this.applies=function(){return!0},this.dataParser=function(e){var r={};return angular.copy(e,r),delete r._links,delete r._embedded,r},this.linkParser=function(n,t,i){if(!angular.isObject(n._links))return null;var o={};return angular.forEach(n._links,function(n,t){angular.isArray(n)||(n=[n]);var s=[];angular.forEach(n,function(r){s.push(e(r,i))}),o[t]=r.fromArray(s)}),o},this.embeddedParser=function(e){var r={};return angular.forEach(e._embedded||{},function(e,n){angular.isArray(e)||(e=[e]),r[n]=e}),r}};return new n}]}).config(["hrResourceProvider",function(e){e.extensions.push("hrHalExtension")}]),angular.module("angular-hy-res-json",["angular-hy-res"]).service("hrJsonExtension",function(){this.applies=function(e,r){return"application/json"===r("Content-Type")},this.dataParser=function(e){return e},this.linkParser=function(){return{}},this.embeddedParser=function(){return[]}}).config(["hrResourceProvider",function(e){e.extensions.push("hrJsonExtension")}]);var httpLink=require("http-link");angular.module("angular-hy-res-link-header",["angular-hy-res"]).service("hrLinkHeaderExtension",["hrWebLinkFactory",function(e){this.applies=function(e,r){return null!==r("Link")},this.dataParser=function(){return{}},this.linkParser=function(r,n,t){for(var i=httpLink.parse(n("Link")),o={},s=0;s<i.length;s++){var a=i[s],u=e(a,t);angular.isUndefined(o[a.rel])?o[a.rel]=[u]:o[a.rel].push(u),delete a.rel}return o},this.embeddedParser=function(){return[]}}]).config(["hrResourceProvider",function(e){e.extensions.push("hrLinkHeaderExtension")}]),angular.module("angular-hy-res-siren",["angular-hy-res"]).provider("hrSirenExtension",function(){this.mediaTypes=["application/vnd.siren+json"],this.$get=["hrWebLinkFactory","hrLinkCollection",function(e){for(var r={},n=0;n<this.mediaTypes.length;n++)r[this.mediaTypes[n]]=!0;var t=function(){this.applies=function(e,n){return void 0!==r[n("Content-Type")]},this.dataParser=function(e){var r=e.properties||{};return e.title&&(r.title=e.title),r},this.linkParser=function(r,n,t){var i={};return angular.isObject(r.links)&&angular.forEach(r.links,function(r){for(var n=e(r,t),o=0;o<r.rel.length;o++){var s=r.rel[o];i.hasOwnProperty(s)?i[s].push(n):i[s]=[n]}}),angular.isObject(r.entities)&&angular.forEach(r.entities,function(r){if(r.href)for(var n=e(r,t),o=0;o<r.rel.length;o++){var s=r.rel[o];i.hasOwnProperty(s)?i[s].push(n):i[s]=[n]}}),i},this.embeddedParser=function(e){var r={};return angular.isArray(e.entities)?(angular.forEach(e.entities,function(e){if(!e.href)for(var n=0;n<e.rel.length;n++){var t=e.rel[n];r.hasOwnProperty(t)||(r[t]=[]),r[t].unshift(e)}}),r):r}};return new t}]}).config(["hrResourceProvider",function(e){e.extensions.push("hrSirenExtension")}]);var WebLink=function(e,r,n,t){angular.extend(this,e),this.$$http=r,this.$$Resource=n,this.$$URITemplate=t};WebLink.prototype.follow=function(e){var r=this.href;this.templated&&(r=new this.$$URITemplate(r).expand(e.data)),e=e||{},e.headers=e.headers||{},this.type&&!e.headers.Accept&&(e.headers.Accept=this.type);var n=angular.extend(e||{},{url:r});return this.$$Resource.fromRequest(this.$$http(n))},angular.module("angular-hy-res",[]).factory("URITemplate",["$window",function(e){return e.URITemplate}]).constant("hrWebLink",WebLink).factory("hrLinkCollection",["$q",function(e){function r(){var e=Object.create(Array.prototype);return e=Array.apply(e,arguments)||e,r.injectClassMethods(e),e}return r.injectClassMethods=function(e){for(var n in r.prototype)r.prototype.hasOwnProperty(n)&&(e[n]=r.prototype[n]);return e},r.fromArray=function(e){return r.apply(null,e)},r.prototype={follow:function(r){var n=this.map(function(e){return e.follow(r)});return n.$promise=e.all(n.map(function(e){return e.$promise})),n.$resolved=!1,n.$promise.then(function(){n.$resolved=!0},function(e){n.$resolved=!0,n.$error=e}),n}},r}]).factory("hrWebLinkFactory",["hrWebLink","$http","URITemplate",function(e,r,n){return function(t,i){return new e(t,r,i,n)}}]).provider("hrResource",function(){this.extensions=[],this.$get=["$http","$q","URITemplate","hrLinkCollection","$injector",function(e,r,n,t,i){var o=[];angular.forEach(this.extensions,function(e){o.push(i.get(e))});var s=function(){this.$resolved=!1,this.$error=null,this.$$links={},this.$$embedded={},this.$link=function(e){var r=this.$links(e);if(0===r.length)return null;if(r.length>1)throw"Multiple links present";return r[0]},this.$links=function(e){return this.$$links.hasOwnProperty(e)?this.$$links[e]:[]},this.$followOne=function(e,r){if(this.$resolved){var n=this.$sub(e);if(null!==n)return n;var t=this.$link(e);return null===t?null:t.follow(r)}var i=new s;return i.$promise=this.$promise.then(function(n){return n.$followOne(e,r).$promise}).then(function(e){var r=i.$promise;return angular.copy(e,i),i.$promise=r,i}),i},this.$followAll=function(e,n){if(this.$resolved){var i=this.$subs(e);return i.length>0?i:t.fromArray(this.$links(e)).follow(n)}var o=[];o.$resolved=!1;var s=r.defer();return o.$promise=s.promise,o.$error=null,this.$promise.then(function(r){var n=r.$followAll(e);return Array.prototype.push.apply(o,n),n.$promise}).then(function(){s.resolve(o),o.$resolved=!0},function(e){s.reject(e),o.$resolved=!0,o.$error=e}),o}};return s.prototype.$subs=function(e){return this.$$embedded.hasOwnProperty(e)?this.$$embedded[e]:[]},s.prototype.$sub=function(e){var r=this.$subs(e);if(0===r.length)return null;if(r.length>1)throw"Multiple sub-resources present";return r[0]},s.prototype.$embedded=s.prototype.$sub,s.prototype.$embeddeds=s.prototype.$subs,s.prototype.$has=function(e){return this.$links(e).length>0||this.$subs(e).length>0},s.prototype.$$resolve=function(e,n){angular.forEach(o,function(t){t.applies(e,n)&&(angular.extend(this,t.dataParser(e,n)),angular.extend(this.$$links,t.linkParser(e,n,s)),angular.forEach(t.embeddedParser(e,n,s),function(e,t){if(angular.isArray(e)){var i=e.map(function(e){return s.embedded(e,n)});i.$promise=r.when(i),i.$resolved=!0,this.$$embedded[t]=i}else this.$$embedded[t]=s.embedded(e,n)},this))},this),this.$resolved=!0},s.embedded=function(e,n){var t=new s;t.$$resolve(e,n);var i=r.defer();return t.$promise=i.promise,i.resolve(t),t},s.fromRequest=function(e){var r=new s;return r.$promise=e.then(function(e){return r.$$resolve(e.data,e.headers),r}),r},s}]}).factory("hrRoot",["hrWebLink","hrResource","$http",function(e,r,n){return function(t,i){return new e({href:t},n,r).follow(i)}}]);