/**
 * angular-hy-res - Hypermedia client for AngularJS inspired by $resource
 * @version v0.0.10 - 2015-04-10
 * @link https://github.com/julienlafont/angular-hy-res
 * @author Julien LAFONT <julien.lafont@tabmo.fr>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";var WebLink=function(e,r,t,n){angular.extend(this,e),this.$$http=r,this.$$Resource=t,this.$$URITemplate=n};WebLink.prototype.follow=function(e){var r=this.href;this.templated&&(r=new this.$$URITemplate(r).expand(e.data)),e=e||{},e.headers=e.headers||{},this.type&&!e.headers.Accept&&(e.headers.Accept=this.type);var t=angular.extend(e||{},{url:r});return this.$$Resource.fromRequest(this.$$http(t))},angular.module("angular-hy-res",[]).factory("URITemplate",["$window",function(e){return e.URITemplate}]).constant("hrWebLink",WebLink).factory("hrLinkCollection",["$q",function(e){function r(){var e=Object.create(Array.prototype);return e=Array.apply(e,arguments)||e,r.injectClassMethods(e),e}return r.injectClassMethods=function(e){for(var t in r.prototype)r.prototype.hasOwnProperty(t)&&(e[t]=r.prototype[t]);return e},r.fromArray=function(e){return r.apply(null,e)},r.prototype={follow:function(r){var t=this.map(function(e){return e.follow(r)});return t.$promise=e.all(t.map(function(e){return e.$promise})),t.$resolved=!1,t.$promise.then(function(){t.$resolved=!0},function(e){t.$resolved=!0,t.$error=e}),t}},r}]).factory("hrWebLinkFactory",["hrWebLink","$http","URITemplate",function(e,r,t){return function(n,o){return new e(n,r,o,t)}}]).provider("hrResource",function(){this.extensions=[],this.$get=["$http","$q","URITemplate","hrLinkCollection","$injector",function(e,r,t,n,o){var i=[];angular.forEach(this.extensions,function(e){i.push(o.get(e))});var s=function(){this.$resolved=!1,this.$error=null,this.$$links={},this.$$embedded={},this.$link=function(e){var r=this.$links(e);if(0===r.length)return null;if(r.length>1)throw"Multiple links present";return r[0]},this.$links=function(e){return this.$$links.hasOwnProperty(e)?this.$$links[e]:[]},this.$followOne=function(e,r){if(this.$resolved){var t=this.$sub(e);if(null!==t)return t;var n=this.$link(e);return null===n?null:n.follow(r)}var o=new s;return o.$promise=this.$promise.then(function(t){return t.$followOne(e,r).$promise}).then(function(e){var r=o.$promise;return angular.copy(e,o),o.$promise=r,o}),o},this.$followAll=function(e,t){if(this.$resolved){var o=this.$subs(e);return o.length>0?o:n.fromArray(this.$links(e)).follow(t)}var i=[];i.$resolved=!1;var s=r.defer();return i.$promise=s.promise,i.$error=null,this.$promise.then(function(r){var t=r.$followAll(e);return Array.prototype.push.apply(i,t),t.$promise}).then(function(){s.resolve(i),i.$resolved=!0},function(e){s.reject(e),i.$resolved=!0,i.$error=e}),i}};return s.prototype.$subs=function(e){return this.$$embedded.hasOwnProperty(e)?this.$$embedded[e]:[]},s.prototype.$sub=function(e){var r=this.$subs(e);if(0===r.length)return null;if(r.length>1)throw"Multiple sub-resources present";return r[0]},s.prototype.$embedded=s.prototype.$sub,s.prototype.$embeddeds=s.prototype.$subs,s.prototype.$has=function(e){return this.$links(e).length>0||this.$subs(e).length>0},s.prototype.$$resolve=function(e,t){angular.forEach(i,function(n){n.applies(e,t)&&(angular.extend(this,n.dataParser(e,t)),angular.extend(this.$$links,n.linkParser(e,t,s)),angular.forEach(n.embeddedParser(e,t,s),function(e,n){if(angular.isArray(e)){var o=e.map(function(e){return s.embedded(e,t)});o.$promise=r.when(o),o.$resolved=!0,this.$$embedded[n]=o}else this.$$embedded[n]=s.embedded(e,t)},this))},this),this.$resolved=!0},s.embedded=function(e,t){var n=new s;n.$$resolve(e,t);var o=r.defer();return n.$promise=o.promise,o.resolve(n),n},s.fromRequest=function(e){var r=new s;return r.$promise=e.then(function(e){return r.$$resolve(e.data,e.headers),r}),r},s}]}).factory("hrRoot",["hrWebLink","hrResource","$http",function(e,r,t){return function(n,o){return new e({href:n},t,r).follow(o)}}]);